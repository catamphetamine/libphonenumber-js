{"version":3,"sources":["../source/formatNumberForMobileDialing.js"],"names":["Metadata","format","get_number_type","check_number_length_for_type","getCountryCallingCode","REGION_CODE_FOR_NON_GEO_ENTITY","COLOMBIA_MOBILE_TO_FIXED_LINE_PREFIX","number","from_country","with_formatting","metadata","hasCountry","Error","phone","country","number_type","is_valid_number","formatted_number","is_fixed_line_or_mobile","formatNationalNumberWithCarrierCode","getPreferredDomesticCarrierCodeOrDefault","length","formatNationalNumberWithPreferredCarrierCode","nationalPrefix","can_be_internationally_dialled","undefined","diallable_chars","DIALLABLE_CHARACTERS","result","i","character"],"mappings":"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","file":"formatNumberForMobileDialing.js","sourcesContent":["// This function is copy-pasted from\n// https://github.com/googlei18n/libphonenumber/blob/master/javascript/i18n/phonenumbers/phonenumberutil.js\n// It hasn't been tested.\n// Carriers codes aren't part of this library.\n// Send a PR if you want to add them.\n\nimport Metadata from './metadata'\n\nimport format from './format'\nimport get_number_type, { check_number_length_for_type } from './getNumberType'\nimport getCountryCallingCode from './getCountryCallingCode'\nimport { REGION_CODE_FOR_NON_GEO_ENTITY } from './common'\n\n/**\n * The prefix that needs to be inserted in front of a Colombian landline number\n * when dialed from a mobile phone in Colombia.\n */\nconst COLOMBIA_MOBILE_TO_FIXED_LINE_PREFIX = '3'\n\n/**\n * Returns a number formatted in such a way that it can be dialed from a mobile\n * phone in a specific region. If the number cannot be reached from the region\n * (e.g. some countries block toll-free numbers from being called outside of the\n * country), the method returns an empty string.\n *\n * @param {object} number - a `parse()`d phone number to be formatted.\n * @param {string} from_country - the region where the call is being placed.\n * @param {boolean} with_formatting - whether the number should be returned with\n *     formatting symbols, such as spaces and dashes.\n * @return {string}\n */\nexport default function(number, from_country, with_formatting, metadata)\n{\n\tmetadata = new Metadata(metadata)\n\n\t// Validate `from_country`.\n\tif (!metadata.hasCountry(from_country))\n\t{\n\t\tthrow new Error(`Unknown country: ${from_country}`)\n\t}\n\n\t// Not using the extension, as that part cannot normally be dialed\n\t// together with the main number.\n\tnumber =\n\t{\n\t\tphone   : number.phone,\n\t\tcountry : number.country\n\t}\n\n\tconst number_type = get_number_type(number, metadata.metadata)\n\tconst is_valid_number = number_type === number\n\n\tlet formatted_number\n\n\tif (country === from_country)\n\t{\n\t\tconst is_fixed_line_or_mobile =\n\t\t\tnumber_type === 'FIXED_LINE' ||\n\t\t\tnumber_type === 'MOBILE' ||\n\t\t\tnumber_type === 'FIXED_LINE_OR_MOBILE'\n\n\t\t// Carrier codes may be needed in some countries. We handle this here.\n\t\tif (country === 'CO' && number_type === 'FIXED_LINE')\n\t\t{\n\t\t\tformatted_number = formatNationalNumberWithCarrierCode\n\t\t\t(\n\t\t\t\tnumber,\n\t\t\t\tCOLOMBIA_MOBILE_TO_FIXED_LINE_PREFIX\n\t\t\t)\n\t\t}\n\t\telse if (country == 'BR' && is_fixed_line_or_mobile)\n\t\t{\n\t\t\tformatted_number =\n\t\t\t\t// Historically, we set this to an empty string when parsing with raw\n\t\t\t\t// input if none was found in the input string. However, this doesn't\n\t\t\t\t// result in a number we can dial. For this reason, we treat the empty\n\t\t\t\t// string the same as if it isn't set at all.\n\t\t\t\tgetPreferredDomesticCarrierCodeOrDefault(number).length > 0 ?\n\t\t\t\tformatNationalNumberWithPreferredCarrierCode(number, '') :\n\t\t\t\t// Brazilian fixed line and mobile numbers need to be dialed with a\n\t\t\t\t// carrier code when called within Brazil. Without that, most of the\n\t\t\t\t// carriers won't connect the call. Because of that, we return an\n\t\t\t\t// empty string here.\n\t\t\t\t''\n\t\t}\n\t\telse if (is_valid_number && country == 'HU')\n\t\t{\n\t\t\t// The national format for HU numbers doesn't contain the national prefix,\n\t\t\t// because that is how numbers are normally written down. However, the\n\t\t\t// national prefix is obligatory when dialing from a mobile phone. As a\n\t\t\t// result, we add it back here if it is a valid regular length phone\n\t\t\t// number.\n\n\t\t\t// Select country for `.nationalPrefix()`.\n\t\t\tmetadata.country(country)\n\n\t\t\tformatted_number = metadata.nationalPrefix() + ' ' + format(number, 'NATIONAL', metadata.metadata)\n\t\t}\n\t\telse if (getCountryCallingCode(country, metadata.metadata) === '1')\n\t\t{\n\t\t\t// For NANPA countries, we output international format for numbers that\n\t\t\t// can be dialed internationally, since that always works, except for\n\t\t\t// numbers which might potentially be short numbers, which are always\n\t\t\t// dialled in national format.\n\n\t\t\t// Select country for `check_number_length_for_type()`.\n\t\t\tmetadata.country(country)\n\n\t\t\tif (can_be_internationally_dialled(number) &&\n\t\t\t\tcheck_number_length_for_type(number.phone, undefined, metadata) !== 'TOO_SHORT')\n\t\t\t{\n\t\t\t\tformatted_number = format(number, 'International', metadata.metadata)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tformatted_number = format(number, 'National', metadata.metadata)\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// For non-geographical countries, Mexican and Chilean fixed line and\n\t\t\t// mobile numbers, we output international format for numbers that can be\n\t\t\t// dialed internationally, as that always works.\n\t\t\tif\n\t\t\t(\n\t\t\t\t(\n\t\t\t\t\tcountry === REGION_CODE_FOR_NON_GEO_ENTITY\n\t\t\t\t\t||\n\t\t\t\t\t// MX fixed line and mobile numbers should always be formatted in\n\t\t\t\t\t// international format, even when dialed within MX. For national\n\t\t\t\t\t// format to work, a carrier code needs to be used, and the correct\n\t\t\t\t\t// carrier code depends on if the caller and callee are from the\n\t\t\t\t\t// same local area. It is trickier to get that to work correctly than\n\t\t\t\t\t// using international format, which is tested to work fine on all\n\t\t\t\t\t// carriers.\n\t\t\t\t\t//\n\t\t\t\t\t// CL fixed line numbers need the national prefix when dialing in the\n\t\t\t\t\t// national format, but don't have it when used for display. The\n\t\t\t\t\t// reverse is true for mobile numbers. As a result, we output them in\n\t\t\t\t\t// the international format to make it work.\n\t\t\t\t\t//\n\t\t\t\t\t// UZ mobile and fixed-line numbers have to be formatted in\n\t\t\t\t\t// international format or prefixed with special codes like 03, 04\n\t\t\t\t\t// (for fixed-line) and 05 (for mobile) for dialling successfully\n\t\t\t\t\t// from mobile devices. As we do not have complete information on\n\t\t\t\t\t// special codes and to be consistent with formatting across all\n\t\t\t\t\t// phone types we return the number in international format here.\n\t\t\t\t\t//\n\t\t\t\t\t((country === 'MX' || country === 'CL' || country == 'UZ') && is_fixed_line_or_mobile)\n\t\t\t\t)\n\t\t\t\t&&\n\t\t\t\tcan_be_internationally_dialled(number)\n\t\t\t)\n\t\t\t{\n\t\t\t\tformatted_number = format(number, 'International')\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tformatted_number = format(number, 'National')\n\t\t\t}\n\t\t}\n\t}\n\telse if (is_valid_number && can_be_internationally_dialled(number))\n\t{\n\t\t// We assume that short numbers are not diallable from outside their region,\n\t\t// so if a number is not a valid regular length phone number, we treat it as\n\t\t// if it cannot be internationally dialled.\n\t\treturn with_formatting ?\n\t\t\tformat(number, 'International', metadata.metadata) :\n\t\t\tformat(number, 'E.164', metadata.metadata)\n\t}\n\n\tif (!with_formatting)\n\t{\n\t\treturn diallable_chars(formatted_number)\n\t}\n\n\treturn formatted_number\n}\n\nfunction can_be_internationally_dialled(number)\n{\n\treturn true\n}\n\n/**\n * A map that contains characters that are essential when dialling. That means\n * any of the characters in this map must not be removed from a number when\n * dialling, otherwise the call will not reach the intended destination.\n */\nconst DIALLABLE_CHARACTERS =\n{\n\t'0': '0',\n\t'1': '1',\n\t'2': '2',\n\t'3': '3',\n\t'4': '4',\n\t'5': '5',\n\t'6': '6',\n\t'7': '7',\n\t'8': '8',\n\t'9': '9',\n\t'+': '+',\n\t'*': '*',\n\t'#': '#'\n}\n\nfunction diallable_chars(formatted_number)\n{\n\tlet result = ''\n\n\tlet i = 0\n\twhile (i < formatted_number.length)\n\t{\n\t\tconst character = formatted_number[i]\n\t\tif (DIALLABLE_CHARACTERS[character])\n\t\t{\n\t\t\tresult += character\n\t\t}\n\t\ti++\n\t}\n\n\treturn result\n}\n\nfunction getPreferredDomesticCarrierCodeOrDefault()\n{\n\tthrow new Error('carrier codes are not part of this library')\n}\n\nfunction formatNationalNumberWithCarrierCode()\n{\n\tthrow new Error('carrier codes are not part of this library')\n}\n\nfunction formatNationalNumberWithPreferredCarrierCode()\n{\n\tthrow new Error('carrier codes are not part of this library')\n}"]}