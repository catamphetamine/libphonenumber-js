<html>
	<head>
		<title>Input Format</title>

		<script src="https://unpkg.com/react@15.3.1/dist/react.js"></script>
		<script src="https://unpkg.com/react-dom@15.3.1/dist/react-dom.js"></script>
		<script src="https://unpkg.com/babel-core@5.8.38/browser.min.js"></script>

		<script src="./input-format.min.js"></script>
		<script src="./libphonenumber-js.min.js"></script>

		<meta charset="utf-8"/>
	</head>

	<style>
		body
		{
			padding: 40px;
		}

		body, input, button
		{
			font-family: Arial, Helvetica;
			font-size: 20px;
		}

		input[type="tel"],
		input[type="text"]
		{
			padding-bottom: 4px;
			border: none;
			border-bottom: 1px solid #0093C4;
			outline: none;
		}

		h2
		{
			margin-top: 60px;
			margin-bottom: 40px;
			border-bottom: 1px solid #afafaf;
		}

		h2:first-child
		{
			margin-top: 0;
		}

		.section
		{
			margin-top: 20px;
		}

		a
		{
			text-decoration: none;
			color: #0093C4;
		}

		a:hover
		{
			text-decoration: underline;
		}

		a.main
		{
			display: block;
			font-size: 32px;
		}

		p
		{
			margin-top: 10px;
			margin-bottom: 40px;
		}

		pre
		{
			margin-top: 50px;
			margin-bottom: 40px;
			padding: 20px;
			border: 1px solid #cfcfcf;
			border-radius: 4px;
			background: #fafafa;
		}

		button
		{
			display: block;
			margin-top: 10px;

			background : none;
			border     : none;
			outline    : none;
			padding    : 0;

			white-space: nowrap;

			color: #0093C4;
		}

		.section__line
		{
			margin-top: 10px;
			margin-bottom: 10px;
		}
	</style>

	<body>
		<a target="_blank" class="main" href="https://github.com/catamphetamine/libphonenumber-js"><code>libphonenumber-js</code></a>

		<p>A simpler (and smaller) rewrite of Google Android's famous <a target="_blank" href="https://github.com/googlei18n/libphonenumber">libphonenumber</a> library</p>

		<div id="content"></div>

		<script type="text/babel">
			var Content = React.createClass
			({
				getInitialState: function()
				{
					return {
						value   : '+12133734253',
						parse   : '213-373-4253',
						format  : '2133734253',
						country : 'US'
					}
				},

				render: function()
				{
					// const libphonenumber = window.libphonenumber
					const input_format   = window['input-format']

					const ReactInput        = input_format.ReactInput
					const templateParser    = input_format.templateParser
					const templateFormatter = input_format.templateFormatter
					const parseDigit        = input_format.parseDigit

					let parsed_number = 'Unknown country'
					let parsed_number_extended = 'Unknown country'
					let national_formatted_number = 'Unknown country'
					let international_formatted_number = 'Unknown country'
					let international_formatted_number_in_E164 = 'Unknown country'
					let international_formatted_number_in_RFC3966 = 'Unknown country'

					const { country, parse, format, value } = this.state

					const asYouType = new libphonenumber.AsYouType(country)
					asYouType.input(value)

					try
					{
						parsed_number = JSON.stringify(libphonenumber.parse(parse, country))
						parsed_number_extended = JSON.stringify(libphonenumber.parse(parse, country, { extended: true }))

						const number_to_format = libphonenumber.parse(format, country)

						national_formatted_number = libphonenumber.format(number_to_format, 'National')
						international_formatted_number = libphonenumber.format(number_to_format, 'International')
						international_formatted_number_in_E164 = libphonenumber.format(number_to_format, 'E.164')
						international_formatted_number_in_RFC3966 = libphonenumber.format(number_to_format, 'RFC3966')
					}
					catch (error)
					{
						if (error.message.indexOf('Unknown country code') === 0)
						{
							//
						}
						else if (error.message.indexOf('A phone number must either be a string or an object of shape') === 0)
						{
							//
						}
						else
						{
							throw error
						}
					}

					return (
						<div>
							<h2>As you type</h2>

							{/* type="tel" introduces bugs on Samsung Android phones */}
							{/* https://github.com/catamphetamine/react-phone-number-input/issues/59 */}
							<ReactInput
								autoFocus
								value={this.state.value}
								onChange={value => this.setState({ value })}
								parse={(character, value) =>
								{
									// Leading plus is allowed
									if (character === '+')
									{
										if (!value)
										{
											return character
										}
									}

									// Digits are allowed
									return parseDigit(character)
								}}
								format={(value) =>
								{
									const asYouType = new libphonenumber.AsYouType(this.state.country)
									const text = asYouType.input(value)

									return { text: text, template: asYouType.template }
								}}/>

							<div className="section">
								<div className="section__line">Value: {this.state.value}</div>
								<div className="section__line">Default country:
									<input
										type="text"
										value={this.state.country}
										onChange={event => this.setState({ country: event.target.value })}
										style={{ width: '40px', marginLeft: '6px' }}/>
								</div>
								<div className="section__line">Actual country: {asYouType.country}</div>
								<div className="section__line">National: {asYouType.country && libphonenumber.format(asYouType.national_number, asYouType.country, 'National')}</div>
								<div className="section__line">Valid: {String(libphonenumber.isValidNumber(this.state.value, asYouType.country))}</div>

								<br/>

								Note: Phone number validation here is loose because it uses the (default) reduced metadata set. For more precise phone number validation use <code>metadata.full.json</code>. <a href="https://github.com/catamphetamine/libphonenumber-js#isvalidnumberparsednumber">Read more</a>
							</div>

							<h2>Parse</h2>

							<input
								type="text"
								value={this.state.country}
								onChange={event => this.setState({ country: event.target.value })}
								style={{ width: '40px', marginRight: '10px' }}/>

							<input
								type="text"
								value={this.state.parse}
								onChange={event => this.setState({ parse: event.target.value })}/>

							<div className="section">
								<code>{parsed_number}</code>
							</div>

							<h2>Parse (extended)</h2>

							<input
								type="text"
								value={this.state.country}
								onChange={event => this.setState({ country: event.target.value })}
								style={{ width: '40px', marginRight: '10px' }}/>

							<input
								type="text"
								value={this.state.parse}
								onChange={event => this.setState({ parse: event.target.value })}/>

							<div className="section">
								<code>{parsed_number_extended}</code>
							</div>

							<h2>Format</h2>

							<input
								type="text"
								value={this.state.country}
								onChange={event => this.setState({ country: event.target.value })}
								style={{ width: '40px', marginRight: '10px' }}/>

							<input
								type="text"
								value={this.state.format}
								onChange={event => this.setState({ format: event.target.value })}/>

							<div className="section">
								<div className="section__line"><code>National: {national_formatted_number}</code></div>
								<div className="section__line"><code>International: {international_formatted_number}</code></div>
								<div className="section__line"><code>E.164: {international_formatted_number_in_E164}</code></div>
								<div className="section__line"><code>RFC3966: {international_formatted_number_in_RFC3966}</code></div>
							</div>
						</div>
					)
				}
			})

			ReactDOM.render
			(
				<Content />,
				document.getElementById('content')
			)
		</script>
	</body>
</html>